{% extends 'base.html' %}

{% block title %}
    NOAA Data for {{ station.name }}
{% endblock title %}
{% block style %}
{% endblock style %}

{% block instructions %}
    You're looking at historical weather data from {{ station.location }}
    in {{ station.name }}{% if station.state %}, {{ station.state }}{% endif %}.
{% endblock instructions %}

{% block content %}
    <div class="content-wrap">
        <h1 class="section-title">Temperature Data for {{ station.location }}</h1>

        {% include 'includes/chart.html' %}
        {% include 'includes/advertisement.html' %}

        <div class="extended-info">
            <div class="station-data column five">
                {% include 'includes/station-data.html' %}

                <div class="station-weather">
                    <div class="tabs-parent seasons box">
                        <ul class="tabs-header unstyled">
                            {% for season in seasons %}
                                <li class="tab {% if loop.first %}active{% endif %}">{{ season.season }}</li>
                            {% endfor %}
                        </ul>
                        {% for season in seasons %}
                            <div class="tab-content {% if not loop.first %}hide{% endif %}" id="Tab-{{ season.season }}">
                                <table class="seasons-data">
                                    <tbody>
                                    <tr>
                                        <td class="label">Avg Temp</td><td class="value">{{ season.temp_dry }}F</td>
                                    </tr>
                                    <tr>
                                        <td class="label">Avg High</td><td class="value">{{ season.temp_dry_high }}F</td>
                                    </tr>
                                    <tr>
                                        <td class="label">Avg Low</td><td class="value">{{ season.temp_dry_low }}F</td>
                                    </tr>
                                    {% if season.humidity %}
                                    <tr>
                                        <td class="label">Avg Humidity</td><td class="value">{{ season.humidity }}%</td>
                                    </tr>
                                    {% endif %}
                                    {% if season.precipitation %}
                                    <tr>
                                        <td class="label">Total Rainfall</td><td class="value">{{ season.precipitation }}in</td>
                                    </tr>
                                        <td class="label">Days of Rain</td><td class="value">{{ season.precipitation_days }}</td>
                                    </tr>
                                    <tr>
                                        <td class="label">Days of Snow</td><td class="value">{{ season.snow_days }}</td>
                                    </tr>
                                    {% endif %}
                                    {% if season.wind_speed %}
                                    <tr>
                                        <td class="label">Avg Wind Speed</td><td class="value">{{ season.wind_speed }}mph</td>
                                    </tr>
                                    {% endif %}
                                    {% if season.wind_direction %}
                                    <tr>
                                        <td class="label">Prevailing Wind</td><td class="value">{{ season.wind_direction }}deg</td>
                                    </tr>
                                    {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="compare column seven">
                <h3>Compare this weather station to another:</h3>
                <div id="map-canvas" class="map-compare"></div>
            </div>
            <div class="clear"></div>
        </div>
    </div>
{% endblock content %}

{% block scripts %}

    <script>
        // quick-and-dirty tab behavior handler for seasonal tabbed interface.
        $('.tabs-parent').on('click', '.tab', function(event){
            var $this = $(this),
                $tabs = $this.parent().siblings('.tab-content'),
                seasonID = '#Tab-' + $this.text();

            if ($this.hasClass('active')) {
                return;
            }

            // toggle tab class
            $this.addClass('active');
            $this.siblings().removeClass('active');

            // toggle content visibility
            $tabs.slideUp();
            $(seasonID).slideDown();
        });
    </script>

    <script>
        var graph = new Dygraph(
            document.getElementById("Weather"),
            "{{ 'weather-csv'|url(station.id) }}",
            {
                rollPeriod: 7,
                showRoller: true,
                customBars: true,
                legend: 'always',
                labelsDiv: document.getElementById('DummyLegend'),
                labels: ["date", "{{ station.name }}"],
                //colors: []
                showRangeSelector: true,
                highlightCallback: drawLegend
            }
        )
    </script>

    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDFbpJc0RjsSyQ9Mucdio3PvK-4w-SK8j0&sensor=false"></script>
    <script>
        function initialize() {
            var mapOptions = {
                center: new google.maps.LatLng({{ station.latitude }}, {{ station.longitude }}),
                zoom: 6,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map-canvas"),
                    mapOptions);

            var marker;
        {% for alt_station in stations %}
            marker = new google.maps.Marker({
                position: new google.maps.LatLng({{ alt_station.latitude }}, {{ alt_station.longitude }}),
                map: map,
                title: '{{ alt_station.id }} - {{ alt_station.name|escapejs }}-{{ alt_station.location|escapejs }}'
            });
            google.maps.event.addListener(marker, 'click', function(){
                window.location.href = "{{ "weather-compare"|url(station.id, alt_station.id) }}"
            });
        {% endfor %}
        //TODO:  Test This!!
            marker = new google.maps.Marker({
                position: new google.maps.LatLng({{ station.latitude }}, {{ station.longitude }}),
                map: map,
                title: '{{ station.id }} - {{ station.name|escapejs }}-{{ station.location|escapejs }}',
                icon: 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png'
            })
        }

        google.maps.event.addDomListener(window, 'load', initialize);
    </script>

{% endblock scripts %}